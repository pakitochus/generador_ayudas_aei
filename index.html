<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario para generar ACKS de AEI</title>
<style>
    label {
        display: block;
        margin-bottom: 10px;
    }
</style>
<!-- Minified version -->
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
<style>
	#my-canvas {
  		background: rgb(255, 255, 255);
		width: 100%;
		height: 300px;
	}
</style>
</head>
<body>
	<header><h1>ACKS de la Agencia Estatal de Investigación</h1>
		
	</header>
<main>
	<h2>Formulario generador</h2>
	<p>Esto es un formulario para generar el de texto de publicidad para ayudas de la AEI. Solo hay que seleccionar los diferentes campos.</p>
<form id="formularioAyuda">
    <label for="referencia">Referencia de la ayuda:</label>
    <input type="text" id="referencia" name="referencia" required><br>
    
    <label for="convocatoria">Convocatoria:</label>
    <select id="convocatoria" name="convocatoria" onchange="actualizarTipoAyuda()" required>
	    <option value="Proyectos Retos Investigación">Proyectos I+D+i - Modalidad «Retos Investigación»</option>
	    <option value="Proyectos Excelencia">Proyectos I+D+i - Modalidad «Excelencia»</option>
	    <option value="Proyectos Generación de Conocimiento">Proyectos I+D+i - Modalidad «Generación de Conocimiento»</option>
	    <option value="Proyectos Investigacion No Orientada">Proyectos I+D+i - Modalidad «Investigación no orientada»</option>
	    <option value="Proyectos Investigacion Orientada">Proyectos I+D+i - Modalidad «Investigación orientada»</option>
	    <option value="Proyectos Pruebas Concepto">Proyectos I+D+i para la realización de «Pruebas de Concepto»</option>
	    <option value="Proyectos Líneas Estratégicas">Proyectos I+D+i en «Líneas Estratégicas»</option>
	    <option value="Proyectos Transición Ecológica y Digital">Proyectos Estratégicos Orientados a la «Transición Ecológica y a la Transición Digital»</option>
	    <option value="Proyectos Retos Colaboración">Proyectos de I+D+I «Retos Colaboración»</option>
	    <option value="Proyectos Colaboración público-privada">Proyectos de Colaboración público-privada</option>
	    <option value="Proyectos Jóvenes Investigadores">Proyectos de I+D+I para «Jóvenes Investigadores»</option>
	    <option value="Proyectos Explora Ciencia y Tecnología">Proyectos «Explora Ciencia» y «Explora Tecnología»</option>
	    <option value="Proyectos Programación conjunta internacional">Proyectos I+D+I y Acciones de «Programación conjunta internacional»</option>
	    <option value="Proyectos Colaboración Internacional">Proyectos de Colaboración Internacional</option>
	    <option value="Proyectos Equipamiento Científico-Técnico">Ayudas para la adquisición de Equipamiento Científico-Técnico</option>
	    <option value="Proyectos Europa Excelencia">Acciones de Dinamización/Proyectos «Europa Excelencia»</option>
	    <option value="Proyectos Europa Investigación">Acciones de Dinamización «Europa Investigación»</option>
	    <option value="Proyectos Europa Redes y Gestores">Europa Redes y Gestores - Europa Centros Tecnológicos</option>
	    <option value="Proyectos Preparación Europeos">Preparación y gestión de proyectos europeos</option>
	    <option value="Proyectos Plataformas tecnológicas y de innovación">Ayudas a Plataformas tecnológicas y de innovación</option>
	    <option value="Proyectos Redes excelencia y Redes investigación">Acciones de Dinamización «Redes excelencia» y «Redes investigación»</option>
	    <option value="Proyectos Centros de Excelencia y Unidades de Excelencia">Centros de Excelencia «Severo Ochoa» y Unidades de Excelencia «María de Maeztu»</option>
	    <option value="Ayudas Contratos Predoctorales">Ayudas para contratos Predoctorales</option>
	    <option value="Ayudas Formación de personal investigador predoctoral">Actuaciones para la formación de personal investigador predoctoral asociadas a los Proyectos de «Generación de Conocimiento»</option>
	    <option value="Ayudas Doctorados industriales">Ayudas para contratos para Doctorados industriales</option>
	    <option value="Ayudas Juan de la Cierva">Ayudas para contratos Juan de la Cierva</option>
	    <option value="Ayudas Juan de la Cierva Formación">Ayudas para contratos Juan de la Cierva Formación (incluidos posdoctorales)</option>
	    <option value="Ayudas Juan de la Cierva Incorporación">Ayudas para contratos Juan de la Cierva Incorporación</option>
	    <option value="Ayudas Ramón y Cajal">Ayudas para contratos Ramón y Cajal</option>
	    <option value="Ayudas Incorporación estable de doctores">Ayudas para incentivar la incorporación estable de doctores</option>
	    <option value="Ayudas Personal técnico de apoyo">Ayudas para contratos de Personal técnico de apoyo</option>
	    <option value="Ayudas Incentivos a la contratación de tecnólogos">Ayudas e incentivos a la contratación de tecnólogos, titulados universitarios, y graduados superiores en formación profesional, para el desarrollo de actividades de apoyo técnico y soporte a la I+D+I (EMPLEA)</option>
	    <option value="Ayudas Promoción de empleo joven">Ayudas para la Promoción de empleo joven</option>
	    <option value="Ayudas Torres Quevedo">Ayudas para contratos Torres Quevedo</option>
	    <option value="Ayudas Consolidacion Investigadora">Ayudas para incentivar la Consolidación Investigadora</option>
	    <option value="Ayudas Incorporación de talento consolidado">Ayudas para la incorporación de talento consolidado – Programa ATRAE</option>
    </select><br>
    
	<label for="año">Año:</label>
	<select id="año" name="año" required onchange="generarTexto()">
	    <option value="2008">2008</option>
	    <option value="2009">2009</option>
	    <option value="2010">2010</option>
	    <option value="2011">2011</option>
	    <option value="2012">2012</option>
	    <option value="2013">2013</option>
	    <option value="2014">2014</option>
	    <option value="2015">2015</option>
	    <option value="2016">2016</option>
	    <option value="2017">2017</option>
	    <option value="2018">2018</option>
	    <option value="2019">2019</option>
	    <option value="2020">2020</option>
	    <option value="2021">2021</option>
	    <option value="2022">2022</option>
	    <option value="2023">2023</option>
	    <option value="2024">2024</option>
	</select><br>
    
    <label for="tipoResultado">Tipo de Resultado:</label>
    <select id="tipoResultado" name="tipoResultado" required onchange="generarTexto()">
        <option value="publication">Publication</option>
        <option value="result">Result</option>
        <option value="equipment">Equipment</option>
        <option value="video">Video</option>
        <option value="activity">Activity</option>
        <option value="contract">Contract</option>
        <option value="otros">Otros</option>
    </select>
    <input type="text" id="campoOtros" name="campoOtros" style="display: none;"><br>
    
    <input type="hidden" id="tipoAyuda" name="tipoAyuda" value="Project">
    
    <label for="tick"><input type="checkbox" id="tick" name="tick" onchange="generarTexto()"> Versión Larga</label>
    <br>
    
    <button type="button" onclick="generarTexto()">Generar Texto</button>
    
    <br><br>
    
    <label for="textoGenerado">Texto Generado:</label>
    <textarea id="textoGenerado" rows="4" cols="50" readonly></textarea> <br>

	<p>Etiqueta: </p>
	<article id="outputContainer" >
		<canvas id="my-canvas"></canvas>
	</article>
	<a class="button" id="linkLabel" href="https://www.aei.gob.es/sites/default/files/inline-images/MICIU+AEI.jpg" target="_blank">ENLACE ETIQUETA</a>
</form>

<p>Fuente: <a href="https://www.aei.gob.es/sites/default/files/inline-files/20240924_Guia%20comunicacion%20publicidad%20ayudas_v02.pdf">web de la AEI</a>. <strong>Actualizado 9 octubre de 2024.</strong></p>
<p><strong>Disclaimer:</strong> no me hago responsable de los posibles errores que pueda contener este formulario, pero siempre podéis abrir un <a href="https://github.com/pakitochus/generador_ayudas_aei/issues">issue</a> y lo intentamos solucionar.</p>
</main>

<script>
function mostrarCampoOtros() {
    var tipoResultado = document.getElementById("tipoResultado");
    var campoOtros = document.getElementById("campoOtros");
    if (tipoResultado.value === "otros") {
        campoOtros.style.display = "block";
    } else {
        campoOtros.style.display = "none";
    }
}

function actualizarTipoAyuda() {
    var convocatoria = document.getElementById("convocatoria").value;
    var tipoAyuda = document.getElementById("tipoAyuda");

    if (convocatoria.toLowerCase().includes("proyectos") ) {
        tipoAyuda.value = "Project";
    } else {
        tipoAyuda.value = "Grant";
    }
	generarTexto()
}


function fitToContainer(canvas){
  // Make it visually fill the positioned parent
  canvas.style.width ='100%';
  canvas.style.height='100%';
  // ...then set the internal size to match
  canvas.width  = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}

function calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight) {
    var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);
    var rtnWidth = srcWidth * ratio;
    var rtnHeight = srcHeight * ratio;
    return {
        width: rtnWidth,
        height: rtnHeight
    };
}

// Función para generar el texto y la imagen basados en los inputs del usuario
function generarTexto() {
    // Obtener valores de los elementos del formulario
    var convocatoria = document.getElementById("convocatoria").value;
    var year = document.getElementById("año").value; 
    var referencia = document.getElementById("referencia").value;
    var tipoResultado = document.getElementById("tipoResultado").value;
    var tipoAyuda = document.getElementById("tipoAyuda").value;
    var textoGenerado = "";
    var linkLabel = document.getElementById("linkLabel");
    var labelIMG = document.getElementById("labelIMG");

    // Generar el texto inicial basado en si el checkbox está marcado o no
    if (document.getElementById("tick").checked) {
        textoGenerado += "This " + tipoResultado + " is part of the " + tipoAyuda.toLowerCase() + " " + referencia + " funded by";
    } else {
        textoGenerado += tipoAyuda + " " + referencia + " funded by";
    }

    // Añadir información de financiación estándar
    textoGenerado += " MICIU/AEI/10.13039/501100011033";
    
    // Agregar casos específicos de financiación adicional basados en la convocatoria y el año
    if ((convocatoria.includes("Proyectos Retos Investigación") && (year>=2015) && (year<=2018)) || 
        (convocatoria.includes("Proyectos Excelencia") && (year>=2015) && (year<=2018)) ||
        (convocatoria.includes("Proyectos Generación de Conocimiento") && (year>=2015) && (year<=2018)) ||
        (convocatoria.includes("Proyectos Investigacion No Orientada") && (year>=2015) && (year<=2018)) ||
        (convocatoria.includes("Proyectos Investigacion Orientada") && (year>=2015) && (year<=2018)) ||
        (convocatoria.includes("Proyectos Retos Colaboración") && (year>=2016) && (year<=2017)) ||
        (convocatoria.includes("Proyectos Jóvenes Investigadores") && (year==2015)) ||
        (convocatoria.includes("Proyectos Equipamiento Científico-Técnico") && ((year==2015)||(year==2018)||(year==2019)))) {     
            textoGenerado += " and by ERDF A way of making Europe";
            linkLabel.href = "https://www.aei.gob.es/sites/default/files/inline-images/MICIU+FEDER+AEI.jpg";
            labelIMG.src = "https://www.aei.gob.es/sites/default/files/inline-images/MICIU+FEDER+AEI.jpg";
    } else if ((convocatoria.includes("Proyectos Generación de Conocimiento") && (year>=2021) && (year<=2023)) ||
            (convocatoria.includes("Proyectos Colaboración público-privada") && (year==2023)) ||
			(convocatoria.includes("Proyectos Líneas Estratégicas") && (year==2024)) ||
            (convocatoria.includes("Proyectos Equipamiento Científico-Técnico") && (year==2024))) {
        textoGenerado += " and by ERDF/EU ";
        linkLabel.href = "https://www.aei.gob.es/sites/default/files/inline-images/MICIU+Cofinanciado+AEI.jpg";
    } else if ((convocatoria.includes("Proyectos Líneas Estratégicas") && (year>=2021) && (year<=2022)) ||
            (convocatoria.includes("Proyectos Transición Ecológica y Digital") && (year==2021)) ||
            (convocatoria.includes("Proyectos Colaboración público-privada") && (year>=2021) && (year<=2022)) ||
            (convocatoria.includes("Proyectos Programación conjunta internacional") && (year>=2020) && (year<=2021)) ||
            (convocatoria.includes("Proyectos Colaboración Internacional") && (year>=2021) && (year<=2022)) ||
            (convocatoria.includes("Proyectos Equipamiento Científico-Técnico") && (year==2021)) ||
            (convocatoria.includes("Proyectos Europa Excelencia") && ((year==2020) || (year==2022) || (year==2023))) ||
            (convocatoria.includes("Proyectos Europa Investigación") && (year==2020)) ||
            (convocatoria.includes("Proyectos Europa Redes y Gestores") && (year==2020)) ||
            (convocatoria.includes("Ayudas Doctorados industriales") && (year==2020)) ||
            (convocatoria.includes("Ayudas Juan de la Cierva") && (year>=2020) && (year<=2022)) ||
            (convocatoria.includes("Ayudas Ramón y Cajal") && (year==2021)) ||
            (convocatoria.includes("Ayudas Consolidacion Investigadora") && (year>=2022) && (year<=2023)) ||
            (convocatoria.includes("Ayudas Torres Quevedo") && (year==2020)) ) {
        textoGenerado += " and by European Union NextGenerationEU/PRTR";
        linkLabel.href = "https://www.aei.gob.es/sites/default/files/inline-images/MICIU+NextG+PRTR+AEI.jpg";
    } else if ((convocatoria.includes("Proyectos Programación conjunta internacional") && (year>=2015) && (year<=2019)) ||
            (convocatoria.includes("Proyectos Colaboración Internacional") && (year>=2023) && (year<=2024))) {
        textoGenerado += " and by the European Union";
        linkLabel.href = "https://www.aei.gob.es/sites/default/files/inline-images/MICIU+Cofinanciado+AEI.jpg";
    } else if ((convocatoria.includes("Ayudas Contratos Predoctorales") && (year>=2016) && (year<=2020)) ||
            (convocatoria.includes("Ayudas Ramón y Cajal") && (year>=2015) && (year<=2020)) ||
            (convocatoria.includes("Ayudas Promoción de empleo joven") && ((year>=2014) || (year==2018)))) {
        textoGenerado += " and by ESF Investing in your future";
        linkLabel.href = "https://www.aei.gob.es/sites/default/files/inline-images/MICIU+FSE+AEI.jpg";
    } else if ((convocatoria.includes("Ayudas Contratos Predoctorales") && (year>=2021) && (year<=2022)) ||
            (convocatoria.includes("Ayudas Formación de personal investigador predoctoral") && (year>=2022) && (year<=2023)) ||
            (convocatoria.includes("Ayudas Juan de la Cierva") && (year==2023)) ||
            (convocatoria.includes("Ayudas Ramón y Cajal") && (year>=2022) && (year<=2023)) ||
            (convocatoria.includes("Ayudas Personal técnico de apoyo") && (year>=2021) && (year<=2023))) {
        textoGenerado += " and by ESF+";
        linkLabel.href = "https://www.aei.gob.es/sites/default/files/inline-images/MICIU+Cofinanciado+AEI.jpg";
    } else {
        linkLabel.href = "https://www.aei.gob.es/sites/default/files/inline-images/MICIU+AEI.jpg";
    }

    // Actualizar el campo de texto generado
    document.getElementById("textoGenerado").value = textoGenerado;


    // Configurar el canvas para dibujar el texto y la imagen
    var canvas = document.getElementById("my-canvas");
    fitToContainer(canvas);
    var context = canvas.getContext("2d");

    // Dibujar la imagen base en el canvas
    make_base();
    // Adjust canvas height to fit text and image
    function adjustCanvasHeight() {
        // Get the text metrics
        // context.font = '16px Arial'; // Adjust font size and family as needed
        const textMetrics = context.measureText(textoGenerado);
        const textHeight = textMetrics.actualBoundingBoxAscent + textMetrics.actualBoundingBoxDescent;

        // Calculate image height
        const imgSize = calculateAspectRatioFit(base_image.width, base_image.height, canvas.clientWidth, canvas.clientHeight);
        const imageHeight = imgSize.height;

        // Set new canvas height (add some padding)
        canvas.height = textHeight + imageHeight + 40; // 40px for padding

        // Redraw everything
        context.clearRect(0, 0, canvas.width, canvas.height);
		context.fillStyle = "white";
		context.fillRect(0, 0, canvas.width, canvas.height);
		context.fillStyle = "black";
		context.font = "16px Arial";
		context.textAlign = 'left';
		context.textBaseline = 'top';
        // Calculate the maximum width for the text
        const maxWidth = canvas.width - 10; // 5px padding on each side
        
        // Split the text into words
        const words = textoGenerado.split(' ');
        let line = '';
        let y = 5;
        
        // Iterate through words and create new lines as needed
        for (let i = 0; i < words.length; i++) {
            const testLine = line + words[i] + ' ';
            const metrics = context.measureText(testLine);
            const testWidth = metrics.width;
            
            if (testWidth > maxWidth && i > 0) {
                context.fillText(line, 5, y);
                line = words[i] + ' ';
                y += 20; // Adjust line height as needed
            } else {
                line = testLine;
            }
        }
        context.fillText(line, 5, y); // Fill the last line

        // base_image = new Image();
        // base_image.src = linkLabel.href;
        context.drawImage(base_image, 4, 5 + textHeight + y + 5, imgSize.width - 8, imgSize.height);
    }

    // Call adjustCanvasHeight after make_base
    base_image.onload = function() {
        make_base();
        adjustCanvasHeight();
		// context.drawImage(base_image, 4, 21 + textHeight + 10, imgSize.width - 8, imgSize.height);
    }


    // Función para cargar y dibujar la imagen base en el canvas
    function make_base()
        {
        base_image = new Image();
        base_image.src = linkLabel.href;

        // var imgSize = calculateAspectRatioFit(base_image.width, base_image.height, canvas.clientWidth, canvas.clientHeight);
        // base_image.onload = function(){
        //     context.drawImage(base_image, 4, 21, imgSize.width-8, imgSize.height);
        // }
    }
}
</script>
<footer>
	<p>2024 Formulario desarrollado por <a href="https://github.com/pakitochus/">pakitochus</a>. Licencia <a href="https://choosealicense.com/licenses/mit/">MIT</a>. CSS by <a href="https://simplecss.org/">SimpleCSS</a></p>
</footer>
</body>
</html>

